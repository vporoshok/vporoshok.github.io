<!DOCTYPE html>
<html lang='ru'>
<head>
    <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='Катастрофически западает солнце'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Задачи RMQ и LCA • Где-то на дальнем сервере'>
<meta property='og:description' content='Катастрофически западает солнце'>
<meta property='og:url' content='https://vporoshok.me/slides/2019/03/rmq__lca/'>
<meta property='og:site_name' content='Где-то на дальнем сервере'>
<meta property='og:type' content='article'><meta property='article:section' content='slides'><meta property='article:published_time' content='2019-03-09T04:07:12Z'/><meta property='article:modified_time' content='2021-10-01T18:45:33&#43;04:00'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.88.1" />

    <title>Задачи RMQ и LCA • Где-то на дальнем сервере</title>
    <link rel='canonical' href='https://vporoshok.me/slides/2019/03/rmq__lca/'>
    
    <link rel='icon' href='/favicon.ico'>
    <link rel='stylesheet' href='/assets/css/main.6a060eb7.css'><link rel='stylesheet' href='/assets/custom.css'><style>
:root{--color-accent:#ffcd00;}
</style>



    <link rel="stylesheet" href="/assets/shower/themes/material/styles/styles.css">
    <style>
        .shower {
            --slide-ratio: calc(16 / 9);
        }
        .caption a {
            display: inline-block;
            font-size: 0.8em;
            margin-left: 2em;
        }
        .mermaid {
            text-align: center;
        }
        .mermaid div {
            transform: translate(-25%, -25%);
        }
        .slide {
            background-repeat: no-repeat;
            background-size: cover;
        }
        .slide a {
            background: none;
        }
        .slide.section {
            display: flex;
            padding: 0;
            align-items: center;
            justify-content: center;
            text-shadow: white 0 0 10px;
        }
        .slide.section h2 {
            font-weight: normal;
        }
        .slide.compact pre {
            padding-top: 0;
        }
        .slide.black * {
            color: white;
            text-shadow: black 0 0 10px;
        }
        img.cover {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body class="shower list entry-content">
    <header class="caption">
        <h1>Задачи RMQ и LCA</h1>
        <p>Катастрофически западает солнце</p>
    </header>

    <!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="equation hidden">
\[
    \gdef\rmq{\mathop{\mathrm{rmq}}}
    \gdef\lca{\mathop{\mathrm{lca}}}
    \gdef\new{\mathop{\mathrm{new}}}
\]
</div>
<section class="slide entry clear"><h2 class="shout">
        Задачи RMQ и LCA
    </h2></section>

<section id="toc" class="slide entry toc"><h2>
        План
    </h2><ol>
<li><a href="#problem">задача и применение</a></li>
<li><a href="#rmq_to_lca">RMQ -&gt; LCA</a></li>
<li><a href="#offline_lca">offline LCA</a></li>
<li><a href="#online_rmq">online RMQ</a></li>
<li><a href="#pm_one_rmq">±1 RMQ</a></li>
<li><a href="#lca_to_pm_one_rmq">LCA -&gt; ±1 RMQ</a></li>
</ol>
</section>

<section id="problem" class="slide entry section"><h2>
        Задача и применение
    </h2></section>

<section class="slide entry"><h2>
        Задача и применение
    </h2><p>RMQ (range minimum query) Выбор наименьшего элемента в отрезке индексов.</p>
<p><strong>Дано:</strong> \(A = \{a_k \colon k &lt; n \}\).</p>
<p><strong>Операции:</strong></p>
<ul>
<li>\(\rmq(i, j) = \min\{a_k \colon i \leqslant k \leqslant j\}\).</li>
</ul>
</section>

<section class="slide entry"><h2>
        Задача и применение
    </h2><p>LCA (less common ancestor) Выбор ближайшего общего предка.</p>
<p><strong>Дано:</strong> дерево.</p>
<p><strong>Операции:</strong></p>
<ul>
<li>\(\lca(u, v) = w\) такое, что \(u \ll w\), \(v \ll w\) и для любого \(t \ll w\) следует, что либо \(u \not\ll t\), либо \(v \not\ll t\).</li>
</ul>
</section>

<section class="slide entry"><h2>
        Задача и применение
    </h2><!-- raw HTML omitted -->
<pre><code>&lt;/figcaption&gt;
</code></pre>
<!-- raw HTML omitted -->
</section>

<section class="slide entry"><h2>
        Задача и применение
    </h2><p>Применение:</p>
<ul>
<li>суффиксное дерево;</li>
<li>суффиксный массив;</li>
<li>поиск по образцу;</li>
<li>поисковые индексы;</li>
</ul>
</section>

<section id="rmq_to_lca" class="slide entry section"><h2>
        RMQ -&gt; LCA
    </h2></section>

<section class="slide entry"><h2>
        RMQ -&gt; LCA
    </h2><p>Для элементов массива \(A\) определим</p>
<ul>
<li>ключ: \(k(a_k) = k\);</li>
<li>приоритет: \(p(a_k) = a_k\);</li>
</ul>
<p>Построим декартово дерево (\(O(n)\)):</p>
<ul>
<li>дерево поиска по ключам;</li>
<li>куча по приоритету;</li>
</ul>
</section>

<section class="slide entry"><h2>
        RMQ -&gt; LCA
    </h2><!-- raw HTML omitted -->
<!-- raw HTML omitted --></section>

<section id="offline_lca" class="slide entry section"><h2>
        Offline LCA
    </h2></section>

<section class="slide entry"><h2>
        Offline LCA
    </h2><p>Пусть все запросы известны заранее</p>
<!-- raw HTML omitted -->
<p>Найдём все ответы за один проход по дереву (Tarjan).</p>
<ol>
<li>Для каждой вершины выпишем все пары, с её участием.</li>
<li>Будем использовать post-order обход.</li>
<li>По мере обхода будем строить DDF.</li>
</ol>
</section>

<section class="slide entry"><h2>
        Offline LCA
    </h2><!-- raw HTML omitted -->
<pre><code>classDef zero  fill:tomato
classDef one   fill:darkorange
classDef two   fill:gold
classDef three fill:chartreuse

class A,B zero
class C,E,F one
class G,I two
class J three
</code></pre>
<!-- raw HTML omitted -->
<pre><code>&lt;/figcaption&gt;
</code></pre>
<!-- raw HTML omitted -->
</section>

<section class="slide entry"><h2>
        Offline LCA
    </h2><p>При рассмотрении вершины \(x\) пройдёмся по всем парам с её участием.</p>
<p>Рассмотрим только те пары, где вторая вершина \(y\) уже просмотрена.</p>
<p>Решением этой пары будет корень дерева, содержащего \(y\).</p>
</section>

<section class="slide entry"><h2>
        Offline LCA
    </h2>Сложность предпросчёта будет</p>
<!-- raw HTML omitted --></section>

<section id="online_rmq" class="slide entry section"><h2>
        Online RMQ
    </h2></section>

<section class="slide entry"><h2>
        Online RMQ
    </h2><p>Можно подсчитать результат для всех возможных запросов</p>
<!-- raw HTML omitted -->
<p>Можно оставить только столбцы с номерами вида \(2^k\)</p>
<!-- raw HTML omitted -->
</section>

<section class="slide entry"><h2>
        Online RMQ
    </h2><p>\(\rmq(i, j)\)</p>
<ul>
<li>\(j - i = 2^k\) &mdash; результат уже есть в таблице</li>
<li>выберем \(k = \max\{\ell \colon j - i &gt; 2^\ell\}\), возьмём из таблицы \(\rmq(i, i + 2^k)\) и \(\rmq(j - 2^k, j)\). Выберем из них минимум.</li>
</ul>
</section>

<section id="pm_one_rmq" class="slide entry section"><h2>
        ±1 RMQ
    </h2></section>

<section class="slide entry"><h2>
        ±1 RMQ
    </h2>Добавим ограничение: \(|a_k - a_{k+1}| = 1\) для \(k &lt; n - 1\).</p>
<!-- raw HTML omitted --></section>

<section class="slide entry"><h2>
        ±1 RMQ
    </h2><p>Разобьём \(A\) на блоки \(B_\ell\) размера \(b\):</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Логарифмическая таблица:</p>
<!-- raw HTML omitted -->
</section>

<section class="slide entry"><p>Запросы \(\rmq(i, j)\) делятся на 2 типа:</p>
<ul>
<li>\(i\) и \(j\) лежат в одном блоке;</li>
</ul>
<p><img src="../img/in_block.svg" alt="Запрос RMQ внутри блока"></p>
<ul>
<li>\(i\) и \(j\) лежат в разных блоках:</li>
</ul>
<p><img src="../img/head-tail.svg" alt="Запрос RMQ с головой, телом и хвостом"></p>
</section>

<section class="slide entry"><h2>
        ±1 RMQ
    </h2><p>Сигнатура блока:</p>
<!-- raw HTML omitted -->
<p>Построим таблицы для всех сигнатур: \(2^{b - 1} \times b \times b\)</p>
</section>

<section class="slide entry"><h2>
        ±1 RMQ
    </h2>Итого расход по памяти:</p>
<!-- raw HTML omitted --></section>

<section class="slide entry"><h2>
        ±1 RMQ
    </h2><p>Итого расход по памяти:</p>
<!-- raw HTML omitted -->
<p>При \(b = \frac{\log n}{2}\):</p>
<!-- raw HTML omitted -->
</section>

<section id="lca_to_pm_one_rmq" class="slide entry section"><h2>
        LCA -&gt; ±1 RMQ
    </h2></section>

<section class="slide entry"><h2>
        LCA -&gt; ±1 RMQ
    </h2><!-- raw HTML omitted -->
<pre><code>&lt;/figcaption&gt;
</code></pre>
<!-- raw HTML omitted -->
</section>

<section class="slide entry"><h2>
        LCA -&gt; ±1 RMQ
    </h2><!-- raw HTML omitted -->
<!-- raw HTML omitted --></section>

<section class="slide entry"><h2>
        LCA -&gt; ±1 RMQ
    </h2><!-- raw HTML omitted -->
<!-- raw HTML omitted --></section>

<section class="slide entry"><h2>
        LCA -&gt; ±1 RMQ
    </h2><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Рассмотрим последовательность глубин:</p>
<!-- raw HTML omitted --></section>

<section class="slide entry"><h2>
        LCA -&gt; ±1 RMQ
    </h2><!-- raw HTML omitted -->
<pre><code>classDef zero  color:tomato
classDef one   color:steelblue
classDef two   color:blueviolet

class E zero
class C one
class A two
</code></pre>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Рассмотрим последовательность глубин:</p>
<!-- raw HTML omitted -->
</section>



    <footer class="badge">
        <a href="/">На главную</a>
    </footer>

    <div class="progress"></div>

    <script src="/assets/shower/shower.min.js"></script><script>window.__assets_js_src="/assets/js/"</script>

<script src='/assets/js/main.67d669ac.js'></script><link rel='stylesheet' href='/assets/katex/katex.min.css'>
<script src='/assets/katex/katex.min.js'></script>
<script src='/assets/katex/contrib/auto-render.min.js'></script>

<script type='text/javascript'>
  renderMathInElement(document.querySelector('.entry-content'),{"throwOnError":true});
</script><script src='/assets/mermaid.min.js' />

<script type='text/javascript'>
  mermaid.initialize({});
</script>

</body>
</html>

---
title: Создаём проект
description: Создаём новый проект и разбираемся что там и для чего
date: 2018-06-23T18:46:51Z
draft: true
categories:
- develop
tags:
- tutorial
- angular
- typescript
---

> Весь код выложен в репозитории https://github.com/vporoshok/dm-play

Для локальной разработки потребуется установить утилиту [@angular/cli](https://github.com/angular/angular-cli).
```sh
npm i -g @angular/cli
```
{{<note "info" "Кстати!">}}
Давным давно, во времена Angular 2 этот пакет назывался `angular-cli`. Местами в сети можно встретить статьи, в которых он устанавливается именно как `npm i -g angular-cli`. Например: https://scotch.io/tutorials/use-the-angular-cli-for-faster-angular-2-projects

Потом этот пакет перенесли в vendor-prefix @angular к остальным библиотекам. Но какое-то время он развивался независимо от самого ядра angular и версионировался соответственно независимо. Это были версии 1.X. Начиная с Angular 6 пакет cli версионируется теми же версиями, что и ядро. На данный момент (2018-06-23) он имеет версию 6.0.8.

Интерфейс команды практически не изменился, но внутри всё поменялось кардинально уже несколько раз. Так, например, в бета-релизах для сборки использовался [broccoli](http://broccolijs.com). Но этот подход подвергся критике со стороны сообщества и к версии 1.0 они перешли на [webpack](https://webpack.js.org) и достаточно регулярно обновляют. Например, сейчас под капотом используется версия 4.8.3.
{{</note>}}

После установки создадим новый проект в удобной для нас директории, набрав в командной строке:
```sh
ng new dm-play
```
где `dm-play` это название [нашего проекта]({{<ref "./dm-play.md">}}), а заодно и папки, которая будет создана. Эта команда развернёт каркас нового проекта и установит необходимые для дальнейшей работы пакеты.

## Шаблон проекта

```sh
.
├── .editorconfig
├── .gitignore
├── README.md
├── angular.json
├── e2e
│   ├── protractor.conf.js
│   ├── src
│   │   ├── app.e2e-spec.ts
│   │   └── app.po.ts
│   └── tsconfig.e2e.json
├── package-lock.json
├── package.json
├── src
│   ├── app
│   │   ├── app.component.css
│   │   ├── app.component.html
│   │   ├── app.component.spec.ts
│   │   ├── app.component.ts
│   │   └── app.module.ts
│   ├── assets
│   │   └── .gitkeep
│   ├── browserslist
│   ├── environments
│   │   ├── environment.prod.ts
│   │   └── environment.ts
│   ├── favicon.ico
│   ├── index.html
│   ├── karma.conf.js
│   ├── main.ts
│   ├── polyfills.ts
│   ├── styles.css
│   ├── test.ts
│   ├── tsconfig.app.json
│   ├── tsconfig.spec.json
│   └── tslint.json
├── tsconfig.json
└── tslint.json
```

Давайте разбираться что же за файлы были созданы, и что с ними можно делать. Начнём с корня проекта, и первый файл, который вы видите:

### .editorconfig

Это файл настройки оформления исходного кода, который поддерживается сейчас практически всеми редакторами. Подробнее про него можно почитать на официальной страничке: http://editorconfig.org.

{{<note "info">}}
Этот файл не относится к ангуляру от слова совсем, однако, в него мы внесём изменения, потому что я воспитан на [pep8](https://www.python.org/dev/peps/pep-0008/) и от вида отступов в 2 пробела у меня начинает болеть голова. К сожалению, как я уже упомянул, сами разработчики @angular/cli всячески [открещиваются](https://github.com/angular/angular-cli/issues/1252) от существования этого файла (правда тогда совсем непонятно — зачем же они его добавили?), но [надежда живёт](https://github.com/angular/angular-cli/issues/6272.
{{</note>}}

### angular.json

Это файл конфигурации сборки приложения (или приложений, как мы увидим в следующих статьях). В данный момент он не представляет для нас особого интереса. Подробную информацию о нём можно найти на странице вики: https://github.com/angular/angular-cli/wiki/angular-cli.

karma.conf.js
Karma — это утилита для запуска тестов. По умолчанию для выполнения кода используется Chrome, что делает практически невозможным запуск тестов на CI. Вообще из существующих фреймворков тестирования мне больше всего нравится Jest, а для выполнения кода, конечно, Puppeteer. Но о тестах и их настройках в другой раз.

package.json
Ну, тут нет ничего необычного, за исключением разве что подготовленных скриптов для стандартных действий: start, build, test, lint и e2e.

protractor.conf.js
Protractor — это ещё один «запускатель» тестов. «Подожди, — скажете вы, — у нас же уже есть запускалка, эта, как её там… Karma!» Да, есть karma, а есть protractor. Они для разных тестов. Karma для unit-тестов, а protractor для так называемых end-to-end тестов, а если говорить по-русски, тестирования пользовательских сценариев. То есть когда мы собираем всё приложение, а потом начинаем имитировать поведение пользователя. Так вот protractor не обычный «запускатель», его написали разработчики ангуляра, специально для тестирования ангуляра. И он имеет из коробки глубокую интеграцию с фреймворком. Но об этом точно в другой статье.

tsconfig.json
Вас ведь предупреждали, что ангуляр не для слабых духом? Самая сильная на мой взгляд черта ангуляра — это TypeScript. Это надмножество javascript со строгой типизацией (по крайней мере так он позиционировался в начале своего пути, однако, уже давно стал большим, чем просто javascript с типами). Файл tsconfig.json, как следует из названия содержит настройки компилятора typescript. Тут стоит с самого старта проекта прописать 2 правила: "strictNullChecks": true и “noImplicitAny”: true. Первая настройка заставляет проверять nullable-переменные на null, а вторая — запрещает объявлять переменные и параметры без типа. Подробнее про все настройки можно почитать тут: http://www.typescriptlang.org/docs/handbook/tsconfig-json.html

Я не раз слышал о том, что typescript замедляет разработку на старте проекта. Но не для меня. Больше всего замедляет меня необходимость постоянно смотреть в документацию (и хорошо, если она есть), чтобы понять какие параметры принимает та или иная функция. Наверно, если знаешь фреймворк вдоль и поперёк, и к тому же работаешь один, то возможно будет замедление, но если в проекте есть другие участники, то бери typescript, не пожалеешь.
tslint.json
Это настройки утилиты tslint статической проверки кода. Незаменимая вещь, когда над проектом работают несколько человек, хотя я использую её и в личных проектах. Самое классное в ней это хорошая интеграция с Visual Studio Code, а также возможность автоматического устранения многих проблем с помощью ng lint --fix.

С корнем покончили, пойдём по папкам, их у нас 3:

e2e — папка для end-to-end тестов;
node_modules — сюда ставятся все пакеты, необходимые для нашего проекта;
src — собственно исходный код нашего проекта!
Исходный код
Здесь тоже всё не просто… ну, то есть не плоско. В корне директории исходного кода помимо favicon.ico лежат следующие файлы:

index.html
Болванка индексной страницы. Здесь можно прописать дополнительные мета-тэги или сторонние стили и скрипты (хотя их лучше подключать в .angular-cli.json, чтобы они собрались в общий бандл зависимостей приложения).

main.ts
Входная точка нашего приложения. Здесь происходит инициализация корневого элемента приложения. Пока оставим этот файл, но обязательно вернёмся, когда будем собирать из нашего приложения виджет для вставки на страницу, не использующую ангуляр.

polyfills.ts
Файл для подключения полифилов. Тут стоит оговориться: проект собирается при помощи webpack, который конфигурируется на основе .angular-cli.json, с помощью Angular DevKit.

Для любопытствующих, кое-какие обломки конфигов webpack, на основе которых собирается конфиг, который собирает ваше приложение, можно найти вот тут: https://github.com/angular/devkit/tree/master/packages/angular_devkit/build_angular/src/angular-cli-files/models/webpack-configs, но эта ссылка может устареть очень быстро, потому как devkit сейчас очень быстро развивается и изменяется.
Так как наше приложение по факту собирается с помощью webpack, оно разбивается на отдельны бандлы (о них будет несколько слов в конец статьи). Так вот полифилы выделяются в отдельный бандл, который грузится сразу после самого загрузчика webpack, до загрузки собственно приложения.

В самом файле достаточно хорошо и полно изложено для каких браузеров какую строчку надо раскомментировать, так что берите свои требования по поддержке браузеров и вперёд.

styles.css
Как написано внутри файла, здесь вы можете объявить глобальные стили своего проекта. Вообще, в названии и местоположении этого файла нет никакой магии, он прописан в .angular-cli.json в настройках приложения, в списке styles, так что его легко можно переместить (требуется для сборки нескольких приложений из одного проекта) или, например, поменять ему расширение на .scss, если вы используете этот препроцессор. В @angular/cli подключены многие базовые загрузчики webpack.

test.ts
Входная точка для unit-тестов. По сути здесь создаётся базовый тестовый модуль ангуляра, после чего отыскиваются все файлы с названием, заканчивающимся на .spec.ts и выполняются. Подробнее поговорим об этом в статье про тестирование.

tsconfig.(app|spec).json
Дополнительные настройки для сборки приложения и тестов, которые наследуются от базовых настроек из файла tsconfig.json, лежащего в корне проекта. В основном они настраивают исключение из сборки приложения тестовых файлов, а к сборке тестовых фалов подключают определения типов (definitions type script или .d.ts-файлы) тестового фреймворка Jasmine.

typings.d.ts
Этот файл то появлялся, то исчезал, то вновь появился. Вообще изначально он был предназначен для прописывания своих собственных определений типов и содержал следующий комментарий:

Typings reference file, you can add your own global typings here
https://www.typescriptlang.org/docs/handbook/writing-declaration-files.html
Однако, в следствии достаточно активного развития проекта @types, он стал фактически не нужен. Теперь в нём содержится описание странного интерфейса какого-то NodeModule. Это наследие старых времён, когда для правильной линковки относительных путей до фалов шаблонов и стилей требовалось прописывать идентификаторы файлов в файловой системе вручную. Теперь же для этого используется специальный загрузчик, который нормально обрабатывает относительные пути.

environments
Папка содержит конфигурации различных окружений для сборки, которые можно выбирать флагом -e <название окружения> при сборке проекта, а значения переменных можно вытаскивать примерно как это делается в main.ts:


Таким образом можно изменять логику приложения в зависимости от окружения.

assets
Эта папка просто копируется в папку результата сборки, так что вы можете складывать туда картинки, шрифты и другие необходимые статические файлы.

app
Это последняя папка, которую мы ещё не обсудили. Это по сути и есть наше приложение. Но о ней в следующий раз.

Собираем, запускаем
Ну, вот наконец-то мы разобрали все файлы, не относящиеся к бизнес-логике нашего приложения. Можно смело набирать в командной строке ng test или ng lint, или ng build. Для всех частых команд в package.json прописаны алиасы для использования локальной утилиты ng.

Кстати, можете обратить внимание на то, что npm start и npm run build соберут разный набор бандлов. Это всё потому что во время сборки для разработки (npm start) ваш код отделяется от кода библиотек, для того чтобы пересборка была максимально быстрой. Это образует бандл vendor.

---
title: Быстро пишем функциональные тесты
description: Как используя golden-файлы, моки и щепотку рефлексии быстро протестировать сложную логику
date: 2019-08-20T08:31:34Z
draft: true
categories:
- develop
tags:
- go
- testing
toc: true
---

## Пара слов о классификации тестов

Напомню, что традиционно выделяют следующие виды тестов:
- **Модульные** --- они же юнит-тесты. Это тесты изолированные внутри пакета/модуля, которые тестируют отдельные методы классов и помогают при разработке.
- **Функциональные** --- тесты, обращающиеся к пакету/модулю как к чёрному ящику, вызывая только публичные методы.
- **Интеграционные** --- они же end-to-end тесты. Они проводятся в среде приближенной к рабочей, с реальными бд и другими сервисами.

Не вдаваясь в холивары, я придерживаюсь той точки зрения, что модульные тесты это инструмент для разработки, когда есть сложная логика, которую легко протестировать. Для них редко нужны моки. В них можно и нужно тестировать приватные методы и функции. Они близки к реализации и при рефакторинге их часто приходится переписывать или просто выкидывать. Ориентироваться на них в приёмке кода нужно с той же степенью как на название локальных переменных.

Функциональные же тесты фиксируют внешний интерфейс пакета/модуля, таким образом при рефакторинге они не должны меняться. И при приёмке кода изменения в них должны тщательно проверяться. В таких тестах всё окружение мокается, чтобы проверить краевые сценарии. Именно о них в контексте Go и пойдёт речь.

Интеграционные тесты вообще выделяются в отдельный пакет или даже проект. О них мы поговорим как-нибудь в другой раз.

## Где располагаются функциональные тесты?

Если опираться на архитектуру, описанную в статье [Чистая архитектура на Go]({{<relref "clean-architect">}}), то основная бизнес-логика сервиса должна располагаться в _Действиях_, в пакете `action`.

## DI. Зависимости и моки

## Golden-файлы

## Сюита. Собираем всё вместе

## Хелперы и базовая сюита
